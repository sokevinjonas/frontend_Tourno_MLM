<div class="min-h-screen bg-slate-950 pt-24 pb-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-6xl mx-auto">
    <!-- Back Link -->
    <a routerLink="/moderator/complaints" class="flex items-center gap-2 text-slate-500 hover:text-white transition-colors mb-8 group w-fit">
      <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
      Retour aux litiges
    </a>

    <!-- Loading State -->
    @if (loading) {
      <div class="flex justify-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
      </div>
    }

    @if (!loading && match) {
      <div class="space-y-8">
        <!-- Match Header -->
        <div class="bg-slate-900 border border-slate-800 rounded-3xl p-8 relative overflow-hidden shadow-2xl">
          <div class="flex flex-col md:flex-row justify-between items-center gap-8">
              <div class="text-center md:text-left">
                  <span class="text-[10px] font-black text-blue-500 uppercase tracking-[0.2em] mb-2 block">Tournoi: {{ match.tournament?.name }}</span>
                  <h1 class="text-4xl font-black text-white uppercase tracking-tight mb-2">Arbitrage du Match</h1>
                  <p class="text-slate-500 font-medium">Round {{ match.round_number }} • ID: {{ match.uuid | slice:0:8 }}...</p>
              </div>
              
              <div class="flex items-center gap-6">
                  <div class="text-center">
                      <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-2">Statut Actuel</p>
                      <span class="px-4 py-2 bg-orange-500/10 text-orange-500 border border-orange-500/20 rounded-xl text-xs font-black uppercase tracking-widest">
                          {{ match.status }}
                      </span>
                  </div>
                  <button (click)="openResolveModal()" class="px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-2xl font-black uppercase tracking-widest transition-all shadow-lg shadow-blue-600/20">
                      Trancher le litige
                  </button>
              </div>
          </div>
        </div>

        <!-- Players Comparison -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Player 1 Profile & Submission -->
          <div class="space-y-6">
              <div class="bg-slate-900 border border-slate-800 rounded-3xl p-6">
                  <div class="flex items-center gap-4 mb-6 pb-6 border-b border-white/5">
                      <div class="w-14 h-14 rounded-2xl bg-slate-800 flex items-center justify-center text-2xl font-bold text-slate-500 border border-slate-700">
                          {{ match?.player1?.name?.charAt(0) || '?' }}
                      </div>
                      <div>
                          <h3 class="text-xl font-black text-white uppercase">{{ match?.player1?.name || 'Joueur 1' }}</h3>
                          <p class="text-xs text-slate-500">Joueur 1</p>
                      </div>
                      <div class="ml-auto text-4xl font-black text-slate-500">{{ match?.player1_score || 0 }}</div>
                  </div>

                  <!-- Submission details -->
                  @if (match.match_results) {
                      @for (res of match.match_results; track res.uuid) {
                          @if (res.submitted_by_uuid === match.player1_uuid) {
                              <div class="space-y-4">
                                  <div class="flex justify-between items-center text-sm">
                                      <span class="text-slate-500">Score déclaré</span>
                                      <span class="text-white font-bold">{{ res.own_score }} - {{ res.opponent_score }}</span>
                                  </div>
                                  <div class="p-4 bg-slate-950 rounded-2xl border border-slate-800 italic text-slate-400 text-sm">
                                      "{{ res.comment || 'Aucun commentaire' }}"
                                  </div>
                                  <div (click)="openImageModal(getScreenshotUrl(res.screenshot_path))" class="aspect-video bg-slate-950 rounded-2xl border border-slate-800 overflow-hidden relative cursor-zoom-in group">
                                      <img [src]="getScreenshotUrl(res.screenshot_path)" class="w-full h-full object-cover transition-transform group-hover:scale-110">
                                      <div class="absolute inset-0 bg-slate-950/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                          <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/></svg>
                                      </div>
                                  </div>
                              </div>
                          }
                      }
                  }
              </div>
          </div>

          <!-- Player 2 Profile & Submission -->
          <div class="space-y-6">
              <div class="bg-slate-900 border border-slate-800 rounded-3xl p-6">
                  <div class="flex items-center gap-4 mb-6 pb-6 border-b border-white/5">
                      <div class="w-14 h-14 rounded-2xl bg-slate-800 flex items-center justify-center text-2xl font-bold text-slate-500 border border-slate-700">
                          {{ match?.player2?.name?.charAt(0) || '?' }}
                      </div>
                      <div>
                          <h3 class="text-xl font-black text-white uppercase">{{ match?.player2?.name || 'Joueur 2' }}</h3>
                          <p class="text-xs text-slate-500">Joueur 2</p>
                      </div>
                      <div class="ml-auto text-4xl font-black text-slate-500">{{ match?.player2_score || 0 }}</div>
                  </div>

                  <!-- Submission details -->
                  @if (match.match_results) {
                      @for (res of match.match_results; track res.uuid) {
                          @if (res.submitted_by_uuid === match.player2_uuid) {
                              <div class="space-y-4">
                                  <div class="flex justify-between items-center text-sm">
                                      <span class="text-slate-500">Score déclaré</span>
                                      <span class="text-white font-bold">{{ res.own_score }} - {{ res.opponent_score }}</span>
                                  </div>
                                  <div class="p-4 bg-slate-950 rounded-2xl border border-slate-800 italic text-slate-400 text-sm">
                                      "{{ res.comment || 'Aucun commentaire' }}"
                                  </div>
                                  <div (click)="openImageModal(getScreenshotUrl(res.screenshot_path))" class="aspect-video bg-slate-950 rounded-2xl border border-slate-800 overflow-hidden relative cursor-zoom-in group">
                                      <img [src]="getScreenshotUrl(res.screenshot_path)" class="w-full h-full object-cover transition-transform group-hover:scale-110">
                                      <div class="absolute inset-0 bg-slate-950/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                                          <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"/></svg>
                                      </div>
                                  </div>
                              </div>
                          }
                      }
                  }
              </div>
          </div>
        </div>
      </div>
    }
  </div>
</div>

<!-- Arbitrage Modal -->
@if (showResolveModal) {
    <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-sm" (click)="closeResolveModal()"></div>
        <div class="bg-slate-900 border border-slate-700 rounded-3xl p-8 max-w-lg w-full relative z-10 shadow-3xl animate-in zoom-in duration-200">
          <div class="text-center mb-8">
            <h3 class="text-2xl font-black text-white mb-2 uppercase tracking-tight">Verdict Final</h3>
            <p class="text-slate-400 text-sm italic">Saisissez les scores officiels confirmés par les preuves.</p>
          </div>
      
          <div class="space-y-8 mb-8">
            <!-- Winner Selection -->
            <div>
              <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 px-1">Gagnant Officiel</label>
              <div class="grid grid-cols-2 gap-4">
                <button 
                  (click)="resolveForm.winner_uuid = match?.player1_uuid || ''"
                  [class.bg-blue-600]="resolveForm.winner_uuid === match?.player1_uuid"
                  [class.border-blue-500]="resolveForm.winner_uuid === match?.player1_uuid"
                  [class.bg-slate-950]="resolveForm.winner_uuid !== match?.player1_uuid"
                  class="p-4 rounded-2xl border border-slate-800 text-white font-bold transition-all"
                >
                  {{ match?.player1?.name }}
                </button>
                <button 
                  (click)="resolveForm.winner_uuid = match?.player2_uuid || ''"
                  [class.bg-blue-600]="resolveForm.winner_uuid === match?.player2_uuid"
                  [class.border-blue-500]="resolveForm.winner_uuid === match?.player2_uuid"
                  [class.bg-slate-950]="resolveForm.winner_uuid !== match?.player2_uuid"
                  class="p-4 rounded-2xl border border-slate-800 text-white font-bold transition-all"
                >
                  {{ match?.player2?.name }}
                </button>
              </div>
            </div>
      
            <!-- Score Entry -->
            <div class="grid grid-cols-2 gap-8 px-2">
              <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 text-center">Score P1</label>
                <input type="number" [(ngModel)]="resolveForm.player1_score" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-center text-3xl font-black text-white focus:outline-none focus:border-blue-500">
              </div>
              <div>
                <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 text-center">Score P2</label>
                <input type="number" [(ngModel)]="resolveForm.player2_score" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-center text-3xl font-black text-white focus:outline-none focus:border-blue-500">
              </div>
            </div>
          </div>
      
          <div class="flex gap-4">
            <button (click)="closeResolveModal()" class="flex-1 py-4 px-4 rounded-2xl border border-slate-700 text-slate-300 font-bold hover:bg-slate-800 transition-colors">Annuler</button>
            <button 
              (click)="confirmResolve()" 
              [disabled]="submitting || !resolveForm.winner_uuid"
              class="flex-1 py-4 px-4 rounded-2xl bg-blue-600 text-white font-bold hover:bg-blue-500 transition-all shadow-lg shadow-blue-600/20 disabled:opacity-50 flex items-center justify-center gap-2"
            >
              Valider le résultat
            </button>
          </div>
        </div>
    </div>
}

<!-- Image Preview Modal -->
@if (showImageModal) {
    <div class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-950/95 backdrop-blur-md" (click)="closeImageModal()"></div>
        <div class="relative max-w-5xl w-full flex flex-col items-center animate-in zoom-in duration-300">
            <button (click)="closeImageModal()" class="absolute -top-12 right-0 p-2 text-slate-400 hover:text-white transition-colors">
                <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
            <img [src]="selectedImageUrl" class="w-full max-h-[85vh] object-contain rounded-2xl shadow-2xl border border-white/10" alt="Preview">
        </div>
    </div>
}
